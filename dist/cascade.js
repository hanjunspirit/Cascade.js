!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.Cascade=t()}}(function(){return function t(i,n,e){function s(r,o){if(!n[r]){if(!i[r]){var c="function"==typeof require&&require;if(!o&&c)return c(r,!0);if(a)return a(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[r]={exports:{}};i[r][0].call(h.exports,function(t){var n=i[r][1][t];return s(n?n:t)},h,h.exports,t,i,n,e)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<e.length;r++)s(e[r]);return s}({1:[function(t,i,n){"use strict";var e={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(t,i,n,e,s,a,r,o){var c,u;try{this._isInTransaction=!0,c=!0,this.initializeAll(0),u=t.call(i,n,e,s,a,r,o),c=!1}catch(t){throw t}finally{try{if(c)try{this.closeAll(0)}catch(t){throw t}else this.closeAll(0)}finally{this._isInTransaction=!1}}return u},initializeAll:function(t){for(var i=this.transactionWrappers,n=t;n<i.length;n++){var e=i[n];try{this.wrapperInitData[n]=s.OBSERVED_ERROR,this.wrapperInitData[n]=e.initialize?e.initialize.call(this):null}catch(t){throw t}finally{if(this.wrapperInitData[n]===s.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(t){throw t}}}},closeAll:function(t){for(var i=this.transactionWrappers,n=t;n<i.length;n++){var e,a=i[n],r=this.wrapperInitData[n];try{e=!0,r!==s.OBSERVED_ERROR&&a.close&&a.close.call(this,r),e=!1}catch(t){throw t}finally{if(e)try{this.closeAll(n+1)}catch(t){throw err}}}this.wrapperInitData.length=0}},s={Mixin:e,OBSERVED_ERROR:{}};i.exports=s},{}],2:[function(t,i,n){/**
 * @preserve Cascade.js
 *
 * @version 1.1.0
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license https://github.com/hanjunspirit/cascade.js/blob/master/LICENSE
 */
"use strict";function e(t,i){this.name=t,this.deps=i,this.status=I.DIRTY}function s(t,i,n,s,a){e.call(this,t,i),t||u("Invalid name in defining state"),void 0===n&&u("Invalid factory in defining state"),this.factory=n,void 0!==a&&(this.initialDeps=s||[],this.initialFactory=a),this.definition=null}function a(t,i,n){e.call(this,t,i),t||u("Invalid name in defining derived data"),"function"!=typeof n&&u("Invalid factory in defining derived data "+t),this.name=t,this.deps=i,this.factory=n,this.status=I.DIRTY}function r(t,i,n){e.call(this,t,i),this.factory=n}function o(){this.statesObj={},this.states={},this._requireIdx=0,this.subscribers=[],this.reinitializeTransaction(),this.impactGraph={}}function c(t){"undefined"!=typeof console&&console.warn(t)}function u(t){throw"undefined"!=typeof console&&console.error(t),new Error(t)}function h(t,i){for(var n in t)i(t[n],n)}function f(t,i){for(var n in t)if(i(t[n],n))return!0;return!1}function p(t,i){var n=[];return h(t,function(t,e){n.push(i(t,e))}),n}function l(t,i){for(var n=0;n<t.length;n++)if(t[n]===i)return n;return-1}function d(t){h(Array.prototype.slice.call(arguments,1),function(i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})}function y(t,i){var n=function(){};n.prototype=i.prototype;var e=new n;d(e,t.prototype),t.prototype=e,t.prototype.constructor=t}function v(){}function b(t){function i(t){n.status="Resolved";for(var i=0;i<n.onResolveCallback.length;i++)n.onResolveCallback[i](t);n.onResolveCallback[i]=[]}this.status="Pending",this.onResolveCallback=[];var n=this;t(i)}var D=t("./Transaction");e.prototype={setDirty:function(){this.status=I.DIRTY},setPending:function(){this.status===I.DIRTY&&(this.status=I.PENDING)},setClean:function(){this.status===I.DIRTY&&(this.status=I.CLEAN)},isClean:function(){return this.status===I.CLEAN},isPending:function(){return this.status===I.PENDING},isDirty:function(){return this.status===I.DIRTY}};var I={DIRTY:1,CLEAN:2,PENDING:3};d(s.prototype,e.prototype),d(a.prototype,e.prototype),d(r.prototype,e.prototype),d(o.prototype,D.Mixin,{define:function(t,i,n,e,a){i=i||[],this.statesObj[t]&&u("State ${name} is already defined"),this._checkDeps(i),this.statesObj[t]=new s(t,i,n,e,a),this._updateImpactGraph(this.statesObj[t]),this.batchedUpdate(function(){this.adjust(t),this.updatedStates[t]=this.getState(t)})},derive:function(t,i,n){i=i||[],this.statesObj[t]&&u("Derived data ${name} is already defined"),this._checkDeps(i),this.statesObj[t]=new a(t,i,n),this._updateImpactGraph(this.statesObj[t]),this.batchedUpdate(function(){this.adjust(t),this.updatedStates[t]=this.getState(t)})},wait:function(t,i){t=t||[],this._checkDeps(t);var n="__require__"+this._requireIdx++;this.statesObj[n]=new r(n,t,i),this._updateImpactGraph(this.statesObj[n]),this.batchedUpdate(function(){this.adjust(n)})},forceUpdate:function(t){var i=this.statesObj[t];i&&i.isClean()&&(i.setDirty(),this.batchedUpdate(function(){this.adjust(t)}))},_checkDeps:function(t){var i=this;h(t,function(t){i.statesObj.hasOwnProperty(t)||u("The dependency ["+t+"] does not exist")})},_updateImpactGraph:function(t){var i=(t.deps||[]).concat(t.initialDeps||[]),n=this;h(i,function(i){(n.impactGraph[i]=n.impactGraph[i]||[]).push(t.name)})},_removeInitialDeps:function(t){var i=t.initialDeps;delete t.initialDeps,delete t.initialFactory;var n=this;h(i,function(i){var e=n.impactGraph[i];e.splice(l(e,t.name),1)})},_removeWaitNode:function(t){if(t&&t instanceof r){var i=this;h(t.deps,function(n){var e=i.impactGraph[n];e.splice(l(e,t.name),1)}),delete this.statesObj[t.name]}},getStates:function(){var t={};for(var i in this.statesObj){var n=this.statesObj[i];n instanceof r||(t[i]=n.isClean()?this.states[i]:null)}return t},getState:function(t){var i=this.statesObj[t];return!i||!i.isClean()||i instanceof r?null:this.states[t]},setState:function(t,i){var n=this.statesObj[t];if(n){if(n instanceof a&&u("You can not set a derived data!"),n.isPending())return void c("You can't set a pending state!");var e=n.definition,s=this.states[t];this.states[t]=e.setter(i,s),this.batchedUpdate(function(){s!==this.states[t]&&(this.updatedStates[t]=this.states[t],this._adjustChildren(t))},this)}},_adjustChildren:function(t){var i=this.getChildren(t),n=this;h(i,function(t){n.statesObj[t].setDirty()}),h(i,function(t){n.adjust(t),!n.statesObj[t]||n.statesObj[t]instanceof r||(n.updatedStates[t]=n.getState(t))})},adjust:function(t){var i=this.statesObj[t];if(i.isDirty()){if(!this._isInTransaction)return void u("adjust calls must be in Transaction");var n=i.deps;i instanceof s&&i.hasOwnProperty("initialFactory")&&(n=n.concat(i.initialDeps));var e=this;if(f(n,function(t){return e.adjust(t),e.statesObj[t].isPending()}))i.setPending();else if(i instanceof s){var c=p(i.deps,function(t){return e.states[t]}),h=i.definition="function"!=typeof i.factory?o.types.Fixed(i.factory):i.factory.apply(null,c);if(h instanceof v||u("Empty definition in state"+t),"initialFactory"in i){if("function"==typeof i.initialFactory)var l=p(i.initialDeps,function(t){return e.states[t]}),d=i.initialFactory.apply(null,l);else var d=i.initialFactory;this.states[t]=h.setter(d),this._removeInitialDeps(i)}else this.states[t]=h.setter(this.states[t]);i.setClean()}else if(i instanceof a){var c=p(i.deps,function(t){return e.states[t]}),y=this.states[t]=i.factory.apply(null,c);if(g(y)){var b=function(n){y===e.states[t]&&e.batchedUpdate(function(){this.states[t]=n,this.updatedStates[t]=this.states[t],i.setDirty(),i.setClean(),this._adjustChildren(t)})};y.then(function(t){return b(t)},function(){return b(null)}),i.setPending()}else i.setClean()}else i instanceof r&&("function"==typeof i.factory&&this.waitToExecs.push(function(){var t=p(i.deps,function(t){return e.states[t]});i.factory.apply(null,t)}),this._removeWaitNode(this.statesObj[t]))}},getChildren:function(t){var i=this,n=[].concat(this.impactGraph[t]||[]);return h(n,function(t){h(i.getChildren(t),function(t){l(n,t)===-1&&n.push(t)})}),n},batchedUpdate:function(t){this._isInTransaction?t.call(this):this.perform(t,this)},subscribe:function(t){l(this.subscribers,t)===-1&&this.subscribers.push(t)},unsubscribe:function(t){var i=l(this.subscribers,t);i!==-1&&this.subscribers.splice(i,1)},getTransactionWrappers:function(){return[w,O]}});var w={initialize:function(){this.waitToExecs=[]},close:function(){for(var t;t=this.waitToExecs.shift();)t()}},O={initialize:function(){this.updatedStates={}},close:function(){var t=0;for(var i in this.updatedStates)t++;if(t>0){var n=this;h(this.subscribers,function(t){t(n.updatedStates)})}this.updatedStates={}}};o.extendDataType=function(t){function i(t){this.args=t}return i.prototype={setter:function(i,n){return t.apply(null,[i,n].concat(this.args))}},y(i,v),function(){return new i(Array.prototype.slice.call(arguments))}},o.types={},o.types.Fixed=o.extendDataType(function(t,i,n){return n}),o.types.Any=o.extendDataType(function(t,i){return t}),o.types.Enum=o.extendDataType(function(t,i,n){return l(n,t)!==-1?t:void 0!==i?i:n[0]}),b.prototype.then=function(t){"Pending"===this.status?t&&this.onResolveCallback.push(t):t&&t()},o.async=function(t){return new b(t)};var g=function(t){return t instanceof b};i.exports=o},{"./Transaction":1}]},{},[2])(2)});